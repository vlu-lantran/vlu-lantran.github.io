<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide: Create Big Data Cluster Using Docker</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; margin: 20px; color: #333; background-color: #f9f9f9; }
        .container { max-width: 900px; margin: auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { color: #0056b3; text-align: center; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        pre { background: #2d2d2d; color: #f0f0f0; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Cascadia Code', 'Consolas', 'Monaco', monospace; margin-bottom: 20px;}
        .image-placeholder { background: #e9e9e9; border: 2px dashed #ccc; padding: 20px; text-align: center; border-radius: 5px; margin: 20px 0; }
        .image-placeholder p { margin: 0; font-style: italic; color: #555; }
        .component-grid { display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px; text-align: center; margin: 30px 0; }
        .component { flex-basis: 22%; min-width: 150px; }
        .step { background-color: #dbeaff; border-left: 5px solid #0056b3; padding: 1px 20px; margin: 20px 0; border-radius: 5px; }

        /* Tab Styles */
        .tab-buttons { overflow: hidden; border-bottom: 1px solid #ccc; background-color: #f1f1f1; border-radius: 8px 8px 0 0; }
        .tab-buttons button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 17px; }
        .tab-buttons button:hover { background-color: #ddd; }
        .tab-buttons button.active { background-color: #007bff; color: white; }
        .tab-content { display: none; padding: 20px; border-top: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Guide: Create Big Data Cluster Using Docker üìä</h1>

        <div class="tab-buttons">
            <!-- <button class="tab-button" onclick="openTab(event, 'Architecture')">üèõÔ∏è Architecture</button> -->
            <button class="tab-button" onclick="openTab(event, 'Setup')">üõ†Ô∏è Setup Guide</button>
            <button class="tab-button" onclick="openTab(event, 'FirstJob')">üìù First Job (Word Count)</button>
        </div>

        <!-- <div id="Architecture" class="tab-content">
            <h2>The Big Picture: Our Architecture</h2>
            <div class="image-placeholder">
                <p><strong>[Diagram of the single-host Docker architecture]</strong><br>This diagram should show one large box for "Your Laptop". Inside, a box for "Docker". Inside Docker, show four smaller boxes for the containers: Spark Master, Spark Worker, Namenode, Datanode. Use arrows to show the Spark Worker connecting to the Master and the Datanode to the Namenode. Add arrows pointing from ports 8080 and 9870 out of the laptop to a "Web Browser" icon.</p>
            </div>

            <h2>The Components: Our Team</h2>
            <div class="component-grid">
                <div class="component">
                    <div class="image-placeholder" style="padding: 10px;"><p>[Icon of a manager or brain]</p></div>
                    <h4>Spark Master</h4>
                    <p>The "Project Manager" for computations.</p>
                </div>
                <div class="component">
                    <div class="image-placeholder" style="padding: 10px;"><p>[Icon of a worker bee or gear]</p></div>
                    <h4>Spark Worker</h4>
                    <p>The "Laborer" that does the actual work.</p>
                </div>
                <div class="component">
                    <div class="image-placeholder" style="padding: 10px;"><p>[Icon of a library index or map]</p></div>
                    <h4>HDFS Namenode</h4>
                    <p>The "Librarian" that knows where data is.</p>
                </div>
                <div class="component">
                    <div class="image-placeholder" style="padding: 10px;"><p>[Icon of a bookshelf or data storage]</p></div>
                    <h4>HDFS Datanode</h4>
                    <p>The "Bookshelves" that store the actual data.</p>
                </div>
            </div>
        </div> -->

        <div id="Setup" class="tab-content">
            <h2>The Setup: 3 Simple Steps</h2>
            <div class="step">
                <h3>Step 1: Create the Blueprint</h3>
                <p>Create a folder, and inside it, a file named <code>docker-compose.yml</code>. Paste this code:</p>
                <pre><code>version: '3.8'

services:
  spark-master:
    image: bde2020/spark-master:3.3.0-hadoop3.3
    container_name: spark-master
    ports:
      - "8080:8080"
      - "7077:7077"
    environment:
      - INIT_DAEMON_STEP=setup_spark
    networks:
      - bigdata_network

  spark-worker:
    image: bde2020/spark-worker:3.3.0-hadoop3.3
    container_name: spark-worker
    depends_on:
      - spark-master
    ports:
      - "8081:8081"
    environment:
      - SPARK_MASTER=spark://spark-master:7077
    networks:
      - bigdata_network

  namenode:
    image: bde2020/hadoop-namenode:2.0.0-hadoop3.2.1-java8
    container_name: namenode
    ports:
      - "9870:9870"
    volumes:
      - hadoop_namenode:/hadoop/dfs/name
    environment:
      - CLUSTER_NAME=test
      - "CORE_CONF_fs_defaultFS=hdfs://namenode:8020"
    networks:
      - bigdata_network

  datanode:
    image: bde2020/hadoop-datanode:2.0.0-hadoop3.2.1-java8
    container_name: datanode
    depends_on:
      - namenode
    volumes:
      - hadoop_datanode:/hadoop/dfs/data
    environment:
      - SERVICE_PRECONDITION=namenode:9870
      - "CORE_CONF_fs_defaultFS=hdfs://namenode:8020"
    networks:
      - bigdata_network

networks:
  bigdata_network:
    driver: bridge

volumes:
  hadoop_namenode:
  hadoop_datanode:
</code></pre>
            </div>
            <div class="step">
                <h3>Step 2: Launch the Cluster üöÄ</h3>
                <p>In your terminal, from the same folder, run:</p>
                <pre><code>docker-compose up -d</code></pre>
            </div>
            <div class="step">
                <h3>Step 3: Verify Everything is Working ‚úÖ</h3>
                <p>Check the web dashboards. This is your proof!</p>
                <p><strong>1. Spark UI: <a href="http://localhost:8080" target="_blank">http://localhost:8080</a></strong></p>
                <img src="images/spark_ui.png" alt="Spark UI" style="width:100%; max-width:600px; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px;">
                <p><strong>2. HDFS UI: <a href="http://localhost:9870" target="_blank">http://localhost:9870</a></strong> (Go to the "Datanodes" tab)</p>
                <img src="images/hdfs_ui.png" alt="HDFS UI" style="width:100%; max-width:600px; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px;">
            </div>
        </div>

        <div id="FirstJob" class="tab-content">
            <h2>Running Your First Job: Word Count</h2>
            <div class="step">
                <h3>Step 1: Enter the Spark Master Container</h3>
                <p>Open a terminal and type:</p>
                <pre><code>docker exec -it namenode bash</code></pre>
            </div>
            <div class="step">
                <h3>Step 2: Create Data and Add it to HDFS</h3>
                <p>Create a simple text file inside the container:</p>
                <pre><code>echo "hello spark hello hadoop spark is great" > test.txt</code></pre>
                <p>Copy the file into HDFS:</p>
                <pre><code>hdfs dfs -mkdir -p /input
hdfs dfs -put test.txt /input</code></pre>
            </div>
            <div class="step">
                <h3>Step 3: Run the PySpark Code</h3>
                <p>Connect to the Spark Master:</p>
                <pre><code>docker exec -it spark-master bash</code></pre>
                <p>Start the interactive PySpark shell:</p>
                <pre><code>/spark/bin/pyspark</code></pre>
                <p>Enter the following Python code one line at a time:</p>
                <pre><code>text_file = sc.textFile("hdfs://namenode:8020/input/test.txt")
counts = text_file.flatMap(lambda line: line.split(" ")) \
                 .map(lambda word: (word, 1)) \
                 .reduceByKey(lambda a, b: a + b)
output = counts.collect()
for (word, count) in output:
    print(f"{word}: {count}")
exit()</code></pre>
            </div>
            <div class="step">
                <h3>Step 4: Check Your Result!</h3>
                <p>You should see the final counts printed to your screen:</p>
                <pre><code>hello: 2
great: 1
spark: 2
hadoop: 1
is: 1</code></pre>
        </div>
    </div>

    <script>
        function openTab(evt, tabName) {
            // Declare all variables
            var i, tabcontent, tabbuttons;

            // Get all elements with class="tab-content" and hide them
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tab-button" and remove the class "active"
            tabbuttons = document.getElementsByClassName("tab-button");
            for (i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].className = tabbuttons[i].className.replace(" active", "");
            }

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Get the element with id="defaultOpen" and click on it to open the first tab by default
        document.querySelector('.tab-button').click();
    </script>
</body>
</html>